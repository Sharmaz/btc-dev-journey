"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[7690],{740(e,i,n){n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"tracks/application-developer/advanced-protocols/index","title":"Advanced Protocols","description":"Multisig, timelocks, atomic swaps, and other advanced Bitcoin transaction patterns","source":"@site/docs/tracks/application-developer/06-advanced-protocols/index.md","sourceDirName":"tracks/application-developer/06-advanced-protocols","slug":"/tracks/application-developer/advanced-protocols/","permalink":"/docs/tracks/application-developer/advanced-protocols/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Advanced Protocols","description":"Multisig, timelocks, atomic swaps, and other advanced Bitcoin transaction patterns"},"sidebar":"guideSidebar","previous":{"title":"Web3 on Bitcoin","permalink":"/docs/tracks/application-developer/web3-bitcoin/"},"next":{"title":"Protocols on Bitcoin","permalink":"/docs/tracks/application-developer/protocols-on-bitcoin/"}}');var t=n(4848),r=n(8453);const o={sidebar_position:6,title:"Advanced Protocols",description:"Multisig, timelocks, atomic swaps, and other advanced Bitcoin transaction patterns"},c="Advanced Protocols",l={},a=[{value:"Multisig",id:"multisig",level:2},{value:"M-of-N Multisig",id:"m-of-n-multisig",level:3},{value:"Implementation Approaches",id:"implementation-approaches",level:3},{value:"PSBT Multisig Workflow",id:"psbt-multisig-workflow",level:3},{value:"Timelocks",id:"timelocks",level:2},{value:"Absolute Timelocks (CLTV)",id:"absolute-timelocks-cltv",level:3},{value:"Relative Timelocks (CSV)",id:"relative-timelocks-csv",level:3},{value:"Atomic Swaps",id:"atomic-swaps",level:2},{value:"How HTLCs Work",id:"how-htlcs-work",level:3},{value:"Submarine Swaps",id:"submarine-swaps",level:3},{value:"Covenants",id:"covenants",level:2},{value:"CoinJoin",id:"coinjoin",level:2},{value:"Recommended Reading",id:"recommended-reading",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"advanced-protocols",children:"Advanced Protocols"})}),"\n",(0,t.jsx)(i.p,{children:"Bitcoin Script enables powerful transaction patterns beyond simple payments. These building blocks are the foundation of more complex applications like Lightning, exchanges, and collaborative custody."}),"\n",(0,t.jsx)(i.h2,{id:"multisig",children:"Multisig"}),"\n",(0,t.jsx)(i.p,{children:"Multisig (multi-signature) requires multiple private keys to authorize a transaction. This is fundamental to collaborative custody and organizational wallets."}),"\n",(0,t.jsx)(i.h3,{id:"m-of-n-multisig",children:"M-of-N Multisig"}),"\n",(0,t.jsx)(i.p,{children:"An M-of-N scheme requires M signatures out of N total keys:"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Setup"}),(0,t.jsx)(i.th,{children:"Use Case"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"2-of-3"})}),(0,t.jsx)(i.td,{children:"Personal security (you hold 2 keys, backup service holds 1)"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"3-of-5"})}),(0,t.jsx)(i.td,{children:"Corporate treasury (requires majority approval)"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"2-of-2"})}),(0,t.jsx)(i.td,{children:"Lightning payment channels"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"1-of-2"})}),(0,t.jsx)(i.td,{children:"Shared access (either party can spend)"})]})]})]}),"\n",(0,t.jsx)(i.h3,{id:"implementation-approaches",children:"Implementation Approaches"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"P2SH multisig"})," \u2014 Legacy, limited to 15 keys"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"P2WSH multisig"})," \u2014 SegWit, more efficient"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"MuSig2 (Taproot)"})," \u2014 Key aggregation, looks like a single-sig on-chain (better privacy and lower fees)"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"psbt-multisig-workflow",children:"PSBT Multisig Workflow"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"1. Creator builds unsigned transaction (PSBT)\n2. Send PSBT to Signer A \u2192 signs with their key\n3. Send partially-signed PSBT to Signer B \u2192 signs with their key\n4. Combiner merges signatures\n5. Finalizer completes the transaction\n6. Broadcast\n"})}),"\n",(0,t.jsx)(i.h2,{id:"timelocks",children:"Timelocks"}),"\n",(0,t.jsx)(i.p,{children:"Timelocks restrict when a transaction can be confirmed:"}),"\n",(0,t.jsx)(i.h3,{id:"absolute-timelocks-cltv",children:"Absolute Timelocks (CLTV)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"OP_CHECKLOCKTIMEVERIFY"})," prevents spending before a specific block height or timestamp:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"# Can't spend before block 800000\nOP_CHECKLOCKTIMEVERIFY OP_DROP <pubkey> OP_CHECKSIG\n"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Use cases:"})," Trust fund releases, scheduled payments, dead man's switches"]}),"\n",(0,t.jsx)(i.h3,{id:"relative-timelocks-csv",children:"Relative Timelocks (CSV)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"OP_CHECKSEQUENCEVERIFY"})," prevents spending until a certain number of blocks have passed since the UTXO was created:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"# Can't spend until 144 blocks (~1 day) after creation\nOP_CHECKSEQUENCEVERIFY OP_DROP <pubkey> OP_CHECKSIG\n"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Use cases:"})," Lightning commitment transactions, revocation paths, cooling-off periods"]}),"\n",(0,t.jsx)(i.h2,{id:"atomic-swaps",children:"Atomic Swaps"}),"\n",(0,t.jsx)(i.p,{children:"Atomic swaps enable trustless exchange of cryptocurrencies across different blockchains using Hash Time-Locked Contracts (HTLCs)."}),"\n",(0,t.jsx)(i.h3,{id:"how-htlcs-work",children:"How HTLCs Work"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    Alice->>Alice: Creates secret S, computes H(S)\n    Alice->>Bitcoin: Lock BTC with HTLC (hash=H(S), timeout=24h)\n    Bob->>Litecoin: Lock LTC with HTLC (hash=H(S), timeout=12h)\n    Alice->>Litecoin: Claims LTC (reveals S)\n    Bob->>Bitcoin: Claims BTC (uses revealed S)"}),"\n",(0,t.jsx)(i.p,{children:"If either party disappears, the timelocks ensure funds are returned."}),"\n",(0,t.jsx)(i.h3,{id:"submarine-swaps",children:"Submarine Swaps"}),"\n",(0,t.jsx)(i.p,{children:"Submarine swaps exchange on-chain Bitcoin for Lightning payments (or vice versa):"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"On-chain \u2192 Lightning:"})," Pay an on-chain HTLC, receive a Lightning payment"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Lightning \u2192 On-chain:"})," Pay a Lightning invoice, receive an on-chain UTXO"]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Services like ",(0,t.jsx)(i.a,{href:"https://boltz.exchange/",children:"Boltz"})," facilitate submarine swaps."]}),"\n",(0,t.jsx)(i.h2,{id:"covenants",children:"Covenants"}),"\n",(0,t.jsx)(i.p,{children:"Covenants restrict how a UTXO can be spent (not just who can spend it). They're an active area of research:"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Proposal"}),(0,t.jsx)(i.th,{children:"Mechanism"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.strong,{children:"OP_CTV"})," (BIP-119)"]}),(0,t.jsx)(i.td,{children:"Commit to the exact transaction that spends the output"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"OP_VAULT"})}),(0,t.jsx)(i.td,{children:"Purpose-built vault construction"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"OP_CAT"})}),(0,t.jsx)(i.td,{children:"Enable arbitrary covenant logic via script composition"})]})]})]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Use cases:"})," Vaults (delayed withdrawals with clawback), congestion control, payment pools"]}),"\n",(0,t.jsx)(i.h2,{id:"coinjoin",children:"CoinJoin"}),"\n",(0,t.jsx)(i.p,{children:"CoinJoin is a privacy technique where multiple users combine their transactions:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsx)(i.li,{children:"Multiple users provide inputs"}),"\n",(0,t.jsx)(i.li,{children:"A coordinator constructs a transaction with uniform outputs"}),"\n",(0,t.jsx)(i.li,{children:"Each user signs their inputs"}),"\n",(0,t.jsx)(i.li,{children:"The combined transaction is broadcast"}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Tools: ",(0,t.jsx)(i.a,{href:"https://github.com/JoinMarket-Org/joinmarket-clientserver",children:"Joinmarket"}),", ",(0,t.jsx)(i.a,{href:"https://wasabiwallet.io/",children:"Wasabi Wallet"})]}),"\n",(0,t.jsx)(i.h2,{id:"recommended-reading",children:"Recommended Reading"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://en.bitcoin.it/wiki/Script",children:"Bitcoin Script Wiki"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki",children:"BIP-65: CLTV"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki",children:"BIP-68/112: CSV"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://en.bitcoin.it/wiki/Atomic_swap",children:"Atomic Swap Explanation"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki",children:"BIP-119: OP_CTV"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,i,n){n.d(i,{R:()=>o,x:()=>c});var s=n(6540);const t={},r=s.createContext(t);function o(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);