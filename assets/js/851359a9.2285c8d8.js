"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[9062],{5717(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"fundamentals/p2p-network/index","title":"P2P Network","description":"How Bitcoin\'s peer-to-peer network and node communication works","source":"@site/docs/fundamentals/03-p2p-network/index.md","sourceDirName":"fundamentals/03-p2p-network","slug":"/fundamentals/p2p-network/","permalink":"/docs/fundamentals/p2p-network/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"P2P Network","description":"How Bitcoin\'s peer-to-peer network and node communication works"},"sidebar":"guideSidebar","previous":{"title":"Bitcoin Architecture","permalink":"/docs/fundamentals/bitcoin-architecture/"},"next":{"title":"Basic Development","permalink":"/docs/fundamentals/basic-development/"}}');var r=s(4848),t=s(8453);const d={sidebar_position:4,title:"P2P Network",description:"How Bitcoin's peer-to-peer network and node communication works"},o="P2P Network",l={},c=[{value:"Network Protocol",id:"network-protocol",level:2},{value:"How Nodes Find Each Other",id:"how-nodes-find-each-other",level:3},{value:"Message Types",id:"message-types",level:3},{value:"Transaction Propagation",id:"transaction-propagation",level:3},{value:"Block Propagation",id:"block-propagation",level:3},{value:"Types of Nodes",id:"types-of-nodes",level:2},{value:"Full Node",id:"full-node",level:3},{value:"Pruned Node",id:"pruned-node",level:3},{value:"SPV Node (Simplified Payment Verification)",id:"spv-node-simplified-payment-verification",level:3},{value:"Mining Node",id:"mining-node",level:3},{value:"Lightning Network Node",id:"lightning-network-node",level:3},{value:"Network Parameters",id:"network-parameters",level:2},{value:"Recommended Reading",id:"recommended-reading",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"p2p-network",children:"P2P Network"})}),"\n",(0,r.jsx)(n.p,{children:"Bitcoin operates as a peer-to-peer network where nodes communicate directly with each other \u2014 no central server, no hierarchy. Understanding this network layer is essential for any Bitcoin developer."}),"\n",(0,r.jsx)(n.h2,{id:"network-protocol",children:"Network Protocol"}),"\n",(0,r.jsx)(n.h3,{id:"how-nodes-find-each-other",children:"How Nodes Find Each Other"}),"\n",(0,r.jsx)(n.p,{children:"When a Bitcoin node starts, it needs to discover other nodes to connect to:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DNS Seeds"})," \u2014 Hardcoded DNS addresses that return IP addresses of known active nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Seed Nodes"})," \u2014 Fallback hardcoded IP addresses if DNS seeds fail"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Addr Messages"})," \u2014 Once connected, nodes share addresses of other known nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manual Peers"})," \u2014 Operators can manually specify peers to connect to"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"message-types",children:"Message Types"}),"\n",(0,r.jsx)(n.p,{children:"Nodes communicate using a binary protocol over TCP (default port 8333 for mainnet). Key message types:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Message"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"version"})," / ",(0,r.jsx)(n.code,{children:"verack"})]}),(0,r.jsx)(n.td,{children:"Handshake \u2014 exchange version info and capabilities"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"inv"})}),(0,r.jsx)(n.td,{children:"Announce new transactions or blocks (inventory)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getdata"})}),(0,r.jsx)(n.td,{children:"Request the full data for announced items"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tx"})}),(0,r.jsx)(n.td,{children:"Send a full transaction"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"block"})}),(0,r.jsx)(n.td,{children:"Send a full block"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers"})}),(0,r.jsx)(n.td,{children:"Send block headers (for SPV and initial sync)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"getblocks"})," / ",(0,r.jsx)(n.code,{children:"getheaders"})]}),(0,r.jsx)(n.td,{children:"Request block hashes or headers"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"ping"})," / ",(0,r.jsx)(n.code,{children:"pong"})]}),(0,r.jsx)(n.td,{children:"Keep connection alive and measure latency"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"addr"})," / ",(0,r.jsx)(n.code,{children:"addrv2"})]}),(0,r.jsx)(n.td,{children:"Share known node addresses"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"feefilter"})}),(0,r.jsx)(n.td,{children:"Tell peers your minimum fee rate for relay"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"transaction-propagation",children:"Transaction Propagation"}),"\n",(0,r.jsx)(n.p,{children:"When a user broadcasts a transaction:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The transaction is sent to connected peers"}),"\n",(0,r.jsx)(n.li,{children:"Each peer validates the transaction independently"}),"\n",(0,r.jsxs)(n.li,{children:["Valid transactions are added to the ",(0,r.jsx)(n.strong,{children:"mempool"})," (memory pool of unconfirmed transactions)"]}),"\n",(0,r.jsx)(n.li,{children:"Peers relay the transaction to their own peers"}),"\n",(0,r.jsx)(n.li,{children:"The transaction propagates across the entire network in seconds"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"block-propagation",children:"Block Propagation"}),"\n",(0,r.jsx)(n.p,{children:"When a miner finds a valid block:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["The miner sends a ",(0,r.jsx)(n.strong,{children:"compact block"})," announcement to peers"]}),"\n",(0,r.jsx)(n.li,{children:"Peers request any transactions they don't already have"}),"\n",(0,r.jsx)(n.li,{children:"Each node independently validates the block (all transactions, proof of work, consensus rules)"}),"\n",(0,r.jsx)(n.li,{children:"Valid blocks are added to the local blockchain"}),"\n",(0,r.jsx)(n.li,{children:"The block propagates to the full network"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Compact Blocks"})," (BIP-152) significantly reduced block propagation time by sending short transaction IDs instead of full transactions \u2014 nodes usually already have the transactions in their mempool."]}),"\n",(0,r.jsx)(n.h2,{id:"types-of-nodes",children:"Types of Nodes"}),"\n",(0,r.jsx)(n.h3,{id:"full-node",children:"Full Node"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"full node"})," downloads and validates every block and transaction since the genesis block. It enforces all consensus rules independently."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stores:"})," The full blockchain (600+ GB as of 2025)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validates:"})," Every transaction and block"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Serves:"})," Blocks and transactions to other nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Trust model:"})," Trustless \u2014 verifies everything independently"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Running a full node is the gold standard for Bitcoin security. It's the only way to be certain your transactions are valid without trusting anyone else."}),"\n",(0,r.jsx)(n.h3,{id:"pruned-node",children:"Pruned Node"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"pruned node"})," is a full node that validates everything but ",(0,r.jsx)(n.strong,{children:"discards old block data"})," to save disk space. It keeps only the UTXO set and recent blocks."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stores:"})," Only recent blocks + UTXO set (configurable, minimum ~550 MB)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validates:"})," Everything (same as full node)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cannot serve:"})," Historical blocks to other nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Good for:"})," Developers and users with limited disk space"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# bitcoin.conf for a pruned node\nprune=1000  # Keep only ~1 GB of block data\n"})}),"\n",(0,r.jsx)(n.h3,{id:"spv-node-simplified-payment-verification",children:"SPV Node (Simplified Payment Verification)"}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.strong,{children:"SPV node"})," only downloads block headers and verifies transactions using Merkle proofs. It relies on full nodes for transaction data."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stores:"})," Only block headers (~60 MB)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validates:"})," Block headers and Merkle proofs (not full transactions)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Trust model:"})," Assumes the longest chain with valid headers contains valid transactions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Used by:"})," Most mobile wallets"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"SPV nodes trade security for efficiency \u2014 they can't independently verify all consensus rules."}),"\n",(0,r.jsx)(n.h3,{id:"mining-node",children:"Mining Node"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"mining node"})," is a full node that also participates in block creation:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Selects transactions from the mempool"}),"\n",(0,r.jsx)(n.li,{children:"Constructs candidate blocks"}),"\n",(0,r.jsx)(n.li,{children:"Performs proof-of-work computation"}),"\n",(0,r.jsx)(n.li,{children:"Broadcasts discovered blocks to the network"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"lightning-network-node",children:"Lightning Network Node"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"Lightning node"})," runs alongside a Bitcoin full node and manages payment channels:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Opens and closes channels (on-chain transactions)"}),"\n",(0,r.jsx)(n.li,{children:"Routes payments through the Lightning network"}),"\n",(0,r.jsx)(n.li,{children:"Maintains channel state and balances"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Popular implementations: LND, CLN (Core Lightning), Eclair, LDK."}),"\n",(0,r.jsx)(n.h2,{id:"network-parameters",children:"Network Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Mainnet"}),(0,r.jsx)(n.th,{children:"Testnet"}),(0,r.jsx)(n.th,{children:"Regtest"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Default port"}),(0,r.jsx)(n.td,{children:"8333"}),(0,r.jsx)(n.td,{children:"18333"}),(0,r.jsx)(n.td,{children:"18444"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Address prefix"}),(0,r.jsx)(n.td,{children:"1, 3, bc1"}),(0,r.jsx)(n.td,{children:"m, n, tb1"}),(0,r.jsx)(n.td,{children:"bcrt1"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Magic bytes"}),(0,r.jsx)(n.td,{children:"0xD9B4BEF9"}),(0,r.jsx)(n.td,{children:"0x0709110B"}),(0,r.jsx)(n.td,{children:"0xDAB5BFFA"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"recommended-reading",children:"Recommended Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.bitcoin.org/devguide/p2p_network.html",children:"Bitcoin Developer Guide: P2P Network"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki",children:"BIP-152 (Compact Blocks)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://en.bitcoin.it/wiki/Protocol_documentation",children:"Bitcoin Protocol Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function d(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);