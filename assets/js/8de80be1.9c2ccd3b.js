"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[5708],{1526(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tracks/protocol-developer/bitcoin-core-internals/code-architecture","title":"Code Architecture","description":"Bitcoin Core source tree layout, build system, and module boundaries","source":"@site/docs/tracks/protocol-developer/01-bitcoin-core-internals/code-architecture.md","sourceDirName":"tracks/protocol-developer/01-bitcoin-core-internals","slug":"/tracks/protocol-developer/bitcoin-core-internals/code-architecture","permalink":"/docs/tracks/protocol-developer/bitcoin-core-internals/code-architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Code Architecture","description":"Bitcoin Core source tree layout, build system, and module boundaries"},"sidebar":"guideSidebar","previous":{"title":"Bitcoin Core Internals","permalink":"/docs/tracks/protocol-developer/bitcoin-core-internals/"},"next":{"title":"Consensus Rules","permalink":"/docs/tracks/protocol-developer/bitcoin-core-internals/consensus"}}');var i=t(4848),s=t(8453);const o={sidebar_position:2,title:"Code Architecture",description:"Bitcoin Core source tree layout, build system, and module boundaries"},c="Code Architecture",d={},l=[{value:"Source Tree Layout",id:"source-tree-layout",level:2},{value:"Key Architectural Concepts",id:"key-architectural-concepts",level:2},{value:"Separation of Consensus",id:"separation-of-consensus",level:3},{value:"Process Architecture",id:"process-architecture",level:3},{value:"Important Interfaces",id:"important-interfaces",level:3},{value:"Build System",id:"build-system",level:2},{value:"Recommended Reading",id:"recommended-reading",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"code-architecture",children:"Code Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"Understanding how Bitcoin Core's source code is organized is the first step to navigating and contributing to the project."}),"\n",(0,i.jsx)(n.h2,{id:"source-tree-layout",children:"Source Tree Layout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"bitcoin/\n\u251c\u2500\u2500 src/                    # Main source code\n\u2502   \u251c\u2500\u2500 consensus/          # Consensus-critical code (minimal dependencies)\n\u2502   \u251c\u2500\u2500 script/             # Script interpreter and verification\n\u2502   \u251c\u2500\u2500 primitives/         # Core data structures (block, transaction)\n\u2502   \u251c\u2500\u2500 wallet/             # Wallet functionality\n\u2502   \u251c\u2500\u2500 rpc/                # RPC command implementations\n\u2502   \u251c\u2500\u2500 net.cpp             # Low-level networking (connections, sockets)\n\u2502   \u251c\u2500\u2500 net_processing.cpp  # Protocol message handling logic\n\u2502   \u251c\u2500\u2500 validation.cpp      # Block and transaction validation\n\u2502   \u251c\u2500\u2500 txmempool.cpp       # Memory pool management\n\u2502   \u251c\u2500\u2500 init.cpp            # Node initialization and startup\n\u2502   \u251c\u2500\u2500 node/               # Node-level interfaces\n\u2502   \u251c\u2500\u2500 kernel/             # Libbitcoinkernel (consensus engine extraction)\n\u2502   \u2514\u2500\u2500 test/               # Unit tests\n\u251c\u2500\u2500 test/                   # Functional tests (Python)\n\u251c\u2500\u2500 doc/                    # Developer documentation\n\u251c\u2500\u2500 contrib/                # Auxiliary scripts and tools\n\u251c\u2500\u2500 depends/                # Cross-compilation dependency builder\n\u2514\u2500\u2500 ci/                     # Continuous integration scripts\n"})}),"\n",(0,i.jsx)(n.h2,{id:"key-architectural-concepts",children:"Key Architectural Concepts"}),"\n",(0,i.jsx)(n.h3,{id:"separation-of-consensus",children:"Separation of Consensus"}),"\n",(0,i.jsxs)(n.p,{children:["Bitcoin Core carefully separates ",(0,i.jsx)(n.strong,{children:"consensus-critical"})," code from everything else. Code in ",(0,i.jsx)(n.code,{children:"src/consensus/"})," and ",(0,i.jsx)(n.code,{children:"src/script/"})," has the strictest review requirements because bugs there could cause chain splits."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"libbitcoinkernel"})," project (ongoing) aims to extract all consensus logic into a standalone library that other implementations could use, reducing the risk of consensus divergence."]}),"\n",(0,i.jsx)(n.h3,{id:"process-architecture",children:"Process Architecture"}),"\n",(0,i.jsx)(n.p,{children:"Bitcoin Core runs as a single process with multiple threads:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Main thread"})," \u2014 Initialization and shutdown"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message handler thread"})," \u2014 Processes P2P messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Net thread"})," \u2014 Manages socket connections"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scheduler thread"})," \u2014 Runs periodic tasks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RPC threads"})," \u2014 Handle API requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Script verification threads"})," \u2014 Parallel signature checking"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"important-interfaces",children:"Important Interfaces"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Interface"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ChainstateManager"})}),(0,i.jsx)(n.td,{children:"Manages blockchain state and validation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CTxMemPool"})}),(0,i.jsx)(n.td,{children:"Transaction memory pool"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CConnman"})}),(0,i.jsx)(n.td,{children:"Connection manager for P2P networking"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PeerManager"})}),(0,i.jsx)(n.td,{children:"High-level peer protocol logic"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CWallet"})}),(0,i.jsx)(n.td,{children:"Wallet operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CScript"})}),(0,i.jsx)(n.td,{children:"Script representation and operations"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"build-system",children:"Build System"}),"\n",(0,i.jsxs)(n.p,{children:["Bitcoin Core uses ",(0,i.jsx)(n.strong,{children:"CMake"})," (migrated from autotools):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Configure\ncmake -B build\n\n# Build with parallel jobs\ncmake --build build -j$(nproc)\n\n# Common CMake options\ncmake -B build -DWITH_BDB=ON          # Enable legacy wallet (BDB)\ncmake -B build -DBUILD_TESTING=ON      # Build unit tests\ncmake -B build -DCMAKE_BUILD_TYPE=Debug  # Debug build\n"})}),"\n",(0,i.jsx)(n.h2,{id:"recommended-reading",children:"Recommended Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md",children:"Bitcoin Core Developer Notes"})," \u2014 Coding conventions and practices"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/design/libraries.md",children:"Source code organization"})," \u2014 Library architecture"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://obc.256k1.dev/",children:"Onboarding to Bitcoin Core"})," \u2014 Guided study program"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,t){t.d(n,{R:()=>o,x:()=>c});var r=t(6540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);