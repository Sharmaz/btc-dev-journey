"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[9808],{4356(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"tracks/application-developer/payment-processing/index","title":"Payment Processing","description":"Building payment flows, invoicing systems, and Lightning Network integration","source":"@site/docs/tracks/application-developer/03-payment-processing/index.md","sourceDirName":"tracks/application-developer/03-payment-processing","slug":"/tracks/application-developer/payment-processing/","permalink":"/docs/tracks/application-developer/payment-processing/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Payment Processing","description":"Building payment flows, invoicing systems, and Lightning Network integration"},"sidebar":"guideSidebar","previous":{"title":"Wallet Development","permalink":"/docs/tracks/application-developer/wallet-development/"},"next":{"title":"Exchange & Trading","permalink":"/docs/tracks/application-developer/exchange-trading/"}}');var s=i(4848),r=i(8453);const o={sidebar_position:3,title:"Payment Processing",description:"Building payment flows, invoicing systems, and Lightning Network integration"},d="Payment Processing",c={},a=[{value:"On-Chain Payments",id:"on-chain-payments",level:2},{value:"Payment Flow",id:"payment-flow",level:3},{value:"Key Considerations",id:"key-considerations",level:3},{value:"Monitoring Payments",id:"monitoring-payments",level:3},{value:"Lightning Payments",id:"lightning-payments",level:2},{value:"BOLT-11 Invoices",id:"bolt-11-invoices",level:3},{value:"Payment Flow (Lightning)",id:"payment-flow-lightning",level:3},{value:"Lightning Integration Options",id:"lightning-integration-options",level:3},{value:"BTCPay Server",id:"btcpay-server",level:2},{value:"Unified QR Codes (BIP-21)",id:"unified-qr-codes-bip-21",level:2},{value:"Recommended Reading",id:"recommended-reading",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"payment-processing",children:"Payment Processing"})}),"\n",(0,s.jsx)(n.p,{children:"Accepting Bitcoin payments involves more than just generating an address. You need to handle confirmations, fee estimation, payment detection, and increasingly, Lightning Network integration for instant payments."}),"\n",(0,s.jsx)(n.h2,{id:"on-chain-payments",children:"On-Chain Payments"}),"\n",(0,s.jsx)(n.h3,{id:"payment-flow",children:"Payment Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\n    A[Generate Address] --\x3e B[Display to Customer]\n    B --\x3e C[Monitor Mempool]\n    C --\x3e D[Detect Payment]\n    D --\x3e E[Wait for Confirmations]\n    E --\x3e F[Mark as Paid]"}),"\n",(0,s.jsx)(n.h3,{id:"key-considerations",children:"Key Considerations"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Factor"}),(0,s.jsx)(n.th,{children:"Recommendation"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Address reuse"})}),(0,s.jsx)(n.td,{children:"Never reuse addresses \u2014 generate a unique address per invoice"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Confirmations"})}),(0,s.jsx)(n.td,{children:"1 confirmation for small amounts, 3-6 for larger amounts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Fee estimation"})}),(0,s.jsxs)(n.td,{children:["Use ",(0,s.jsx)(n.code,{children:"estimatesmartfee"})," or mempool-based estimation"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Payment detection"})}),(0,s.jsx)(n.td,{children:"Watch the mempool for 0-conf, then track confirmations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Timeouts"})}),(0,s.jsx)(n.td,{children:"Set invoice expiry (e.g., 15-60 minutes)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Overpayment/underpayment"})}),(0,s.jsx)(n.td,{children:"Define tolerance ranges"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-payments",children:"Monitoring Payments"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Using bitcoin-cli\nbitcoin-cli listtransactions "*" 10  # Recent transactions\n\n# Watch a specific address (requires addressindex or wallet import)\nbitcoin-cli importaddress "bc1q..." "invoice-001" false\n'})}),"\n",(0,s.jsx)(n.p,{children:"For production, use a dedicated backend:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Electrum server"})," \u2014 Efficient address-based queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Esplora API"})," \u2014 REST API for address/transaction lookups"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bitcoin Core wallet"})," \u2014 Direct RPC, most private"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"lightning-payments",children:"Lightning Payments"}),"\n",(0,s.jsx)(n.p,{children:"Lightning enables instant, low-fee payments \u2014 ideal for point-of-sale and small transactions."}),"\n",(0,s.jsx)(n.h3,{id:"bolt-11-invoices",children:"BOLT-11 Invoices"}),"\n",(0,s.jsx)(n.p,{children:"Lightning payments use BOLT-11 invoices:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'lnbc10u1pj...  \u2190 encoded invoice\n\nDecoded:\n  Amount: 10,000 sats\n  Description: "Coffee"\n  Payment hash: abc123...\n  Expiry: 3600 seconds\n  Node pubkey: 02def...\n'})}),"\n",(0,s.jsx)(n.h3,{id:"payment-flow-lightning",children:"Payment Flow (Lightning)"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\n    A[Create Invoice] --\x3e B[Display QR Code]\n    B --\x3e C[Customer Pays]\n    C --\x3e D[Payment Settles ~1s]\n    D --\x3e E[Webhook/Callback]"}),"\n",(0,s.jsx)(n.h3,{id:"lightning-integration-options",children:"Lightning Integration Options"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Approach"}),(0,s.jsx)(n.th,{children:"Complexity"}),(0,s.jsx)(n.th,{children:"Control"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"BTCPay Server"})}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Self-hosted, full control"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"LND/CLN API"})}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"Direct node access"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"LDK"})}),(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"Custom implementation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Hosted API"})," (Strike, etc.)"]}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Third-party dependency"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"btcpay-server",children:"BTCPay Server"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://btcpayserver.org/",children:"BTCPay Server"})," is the most popular open-source payment processor:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Self-hosted (no third party)"}),"\n",(0,s.jsx)(n.li,{children:"On-chain + Lightning support"}),"\n",(0,s.jsx)(n.li,{children:"Shopify, WooCommerce, and other integrations"}),"\n",(0,s.jsx)(n.li,{children:"Built-in invoicing, point-of-sale, and crowdfunding"}),"\n",(0,s.jsx)(n.li,{children:"API for custom integrations"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Deploy with Docker\ngit clone https://github.com/btcpayserver/btcpayserver-docker\ncd btcpayserver-docker\n./btcpay-setup.sh\n"})}),"\n",(0,s.jsx)(n.h2,{id:"unified-qr-codes-bip-21",children:"Unified QR Codes (BIP-21)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki",children:"BIP-21"})," defines a URI scheme that can include both on-chain and Lightning options:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"bitcoin:bc1qaddress?amount=0.001&lightning=lnbc1000...\n"})}),"\n",(0,s.jsx)(n.p,{children:"This lets the payer choose on-chain or Lightning from a single QR code."}),"\n",(0,s.jsx)(n.h2,{id:"recommended-reading",children:"Recommended Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.btcpayserver.org/",children:"BTCPay Server Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki",children:"BIP-21: URI Scheme"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/lightning/bolts/blob/master/11-payment-encoding.md",children:"BOLT-11: Invoice Protocol"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://bitcoin.design/guide/how-it-works/payments/",children:"Bitcoin Design Guide: Payments"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,n,i){i.d(n,{R:()=>o,x:()=>d});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);