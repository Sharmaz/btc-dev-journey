"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[5183],{8077(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tracks/protocol-developer/testing/index","title":"Testing","description":"Testing methodologies in Bitcoin Core - functional tests, unit tests, and fuzz testing","source":"@site/docs/tracks/protocol-developer/03-testing/index.md","sourceDirName":"tracks/protocol-developer/03-testing","slug":"/tracks/protocol-developer/testing/","permalink":"/docs/tracks/protocol-developer/testing/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Testing","description":"Testing methodologies in Bitcoin Core - functional tests, unit tests, and fuzz testing"},"sidebar":"guideSidebar","previous":{"title":"Languages & Tools","permalink":"/docs/tracks/protocol-developer/languages-tools/"},"next":{"title":"Bitcoin Improvement Proposals (BIPs)","permalink":"/docs/tracks/protocol-developer/bips/"}}');var i=t(4848),r=t(8453);const l={sidebar_position:3,title:"Testing",description:"Testing methodologies in Bitcoin Core - functional tests, unit tests, and fuzz testing"},o="Testing",d={},c=[{value:"Testing Layers",id:"testing-layers",level:2},{value:"Unit Tests (C++)",id:"unit-tests-c",level:3},{value:"Functional Tests (Python)",id:"functional-tests-python",level:3},{value:"Fuzz Testing",id:"fuzz-testing",level:3},{value:"Linting",id:"linting",level:3},{value:"CI Infrastructure",id:"ci-infrastructure",level:2},{value:"Sanitizers",id:"sanitizers",level:3},{value:"Writing Good Tests",id:"writing-good-tests",level:2},{value:"Recommended Reading",id:"recommended-reading",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"testing",children:"Testing"})}),"\n",(0,i.jsx)(n.p,{children:"Testing is not optional in Bitcoin Core \u2014 it's a first-class requirement. Every pull request must include appropriate tests. The project has multiple testing layers, each catching different types of bugs."}),"\n",(0,i.jsx)(n.h2,{id:"testing-layers",children:"Testing Layers"}),"\n",(0,i.jsx)(n.h3,{id:"unit-tests-c",children:"Unit Tests (C++)"}),"\n",(0,i.jsxs)(n.p,{children:["Located in ",(0,i.jsx)(n.code,{children:"src/test/"}),", these test individual functions and classes in isolation:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build and run unit tests\ncmake --build build\nctest --test-dir build\n\n# Run specific test suite\n./build/src/test/test_bitcoin --run_test=script_tests\n\n# List available test suites\n./build/src/test/test_bitcoin --list_content\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Unit tests use the ",(0,i.jsx)(n.strong,{children:"Boost.Test"})," framework:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"BOOST_AUTO_TEST_SUITE(example_tests)\n\nBOOST_AUTO_TEST_CASE(basic_check)\n{\n    CTransaction tx;\n    BOOST_CHECK(tx.vin.empty());\n    BOOST_CHECK(tx.vout.empty());\n}\n\nBOOST_AUTO_TEST_SUITE_END()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"functional-tests-python",children:"Functional Tests (Python)"}),"\n",(0,i.jsxs)(n.p,{children:["Located in ",(0,i.jsx)(n.code,{children:"test/functional/"}),", these spin up actual Bitcoin Core nodes and test end-to-end behavior:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run entire functional test suite\ntest/functional/test_runner.py\n\n# Run specific test with logging\ntest/functional/feature_block.py --loglevel=debug\n\n# Run tests in parallel\ntest/functional/test_runner.py -j8\n"})}),"\n",(0,i.jsx)(n.p,{children:"Functional tests are the primary way to test protocol-level changes. They simulate real network conditions with multiple nodes."}),"\n",(0,i.jsx)(n.h3,{id:"fuzz-testing",children:"Fuzz Testing"}),"\n",(0,i.jsx)(n.p,{children:"Fuzz testing feeds random or semi-random data to parsing functions to find crashes, hangs, and undefined behavior:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build with fuzzing support\ncmake -B build -DSANITIZERS=fuzzer\ncmake --build build\n\n# Run a fuzz target\n./build/src/test/fuzz/deserialize_block\n\n# Run with a corpus\n./build/src/test/fuzz/deserialize_block corpus/\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Bitcoin Core has ",(0,i.jsx)(n.strong,{children:"hundreds of fuzz targets"})," covering deserialization, script parsing, network message handling, and more. The ",(0,i.jsx)(n.a,{href:"https://google.github.io/oss-fuzz/",children:"OSS-Fuzz"})," project continuously fuzzes Bitcoin Core."]}),"\n",(0,i.jsx)(n.h3,{id:"linting",children:"Linting"}),"\n",(0,i.jsx)(n.p,{children:"Static analysis and style checks run in CI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all linters\ntest/lint/run-lint.sh\n\n# Specific checks\ntest/lint/lint-circular-dependencies.py\ntest/lint/lint-includes.py\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ci-infrastructure",children:"CI Infrastructure"}),"\n",(0,i.jsx)(n.p,{children:"Every pull request runs through automated CI:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"System"}),(0,i.jsx)(n.th,{children:"What It Checks"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GitHub Actions"})}),(0,i.jsx)(n.td,{children:"Build on multiple platforms, run tests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Cirrus CI"})}),(0,i.jsx)(n.td,{children:"macOS builds, sanitizer runs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"OSS-Fuzz"})}),(0,i.jsx)(n.td,{children:"Continuous fuzz testing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Guix builds"})}),(0,i.jsx)(n.td,{children:"Reproducible binary builds"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"sanitizers",children:"Sanitizers"}),"\n",(0,i.jsx)(n.p,{children:"Bitcoin Core CI uses LLVM sanitizers to catch memory and threading bugs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ASan"})," (AddressSanitizer) \u2014 Buffer overflows, use-after-free"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"UBSan"})," (UndefinedBehaviorSanitizer) \u2014 Integer overflow, null pointer dereference"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TSan"})," (ThreadSanitizer) \u2014 Data races"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MSan"})," (MemorySanitizer) \u2014 Uninitialized memory reads"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Build with sanitizers\ncmake -B build -DSANITIZERS="address;undefined"\ncmake --build build\n'})}),"\n",(0,i.jsx)(n.h2,{id:"writing-good-tests",children:"Writing Good Tests"}),"\n",(0,i.jsx)(n.p,{children:"When contributing to Bitcoin Core, follow these testing guidelines:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test the behavior, not the implementation"})," \u2014 Tests should verify what the code does, not how it does it"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test edge cases"})," \u2014 Empty inputs, maximum values, malformed data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test failure modes"})," \u2014 Ensure invalid inputs are rejected correctly"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Don't test framework functionality"})," \u2014 Trust Boost.Test and the Python framework"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep tests deterministic"})," \u2014 Avoid timing dependencies and random failures"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"recommended-reading",children:"Recommended Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bitcoin/bitcoin/tree/master/test",children:"Bitcoin Core Test Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bitcoin/bitcoin/blob/master/test/functional/README.md",children:"Functional Test README"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/fuzzing.md",children:"Fuzz Testing Guide"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,t){t.d(n,{R:()=>l,x:()=>o});var s=t(6540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);