"use strict";(globalThis.webpackChunkbtc_dev_journey=globalThis.webpackChunkbtc_dev_journey||[]).push([[1275],{824(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"tracks/protocol-developer/bitcoin-core-internals/consensus","title":"Reglas de Consenso","description":"Entendiendo las reglas de consenso de Bitcoin, l\xf3gica de validaci\xf3n y activaci\xf3n de soft forks","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/tracks/protocol-developer/01-bitcoin-core-internals/consensus.md","sourceDirName":"tracks/protocol-developer/01-bitcoin-core-internals","slug":"/tracks/protocol-developer/bitcoin-core-internals/consensus","permalink":"/es/docs/tracks/protocol-developer/bitcoin-core-internals/consensus","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Reglas de Consenso","description":"Entendiendo las reglas de consenso de Bitcoin, l\xf3gica de validaci\xf3n y activaci\xf3n de soft forks"},"sidebar":"guideSidebar","previous":{"title":"Arquitectura del C\xf3digo","permalink":"/es/docs/tracks/protocol-developer/bitcoin-core-internals/code-architecture"},"next":{"title":"Lenguajes y Herramientas","permalink":"/es/docs/tracks/protocol-developer/languages-tools/"}}');var o=s(4848),a=s(8453);const d={sidebar_position:3,title:"Reglas de Consenso",description:"Entendiendo las reglas de consenso de Bitcoin, l\xf3gica de validaci\xf3n y activaci\xf3n de soft forks"},l="Reglas de Consenso",c={},r=[{value:"\xbfQu\xe9 Son las Reglas de Consenso?",id:"qu\xe9-son-las-reglas-de-consenso",level:2},{value:"Reglas a Nivel de Bloque",id:"reglas-a-nivel-de-bloque",level:3},{value:"Reglas a Nivel de Transacci\xf3n",id:"reglas-a-nivel-de-transacci\xf3n",level:3},{value:"Validaci\xf3n de Script",id:"validaci\xf3n-de-script",level:3},{value:"Soft Forks",id:"soft-forks",level:2},{value:"Soft Forks Notables",id:"soft-forks-notables",level:3},{value:"Mecanismos de Activaci\xf3n",id:"mecanismos-de-activaci\xf3n",level:3},{value:"Validaci\xf3n en el C\xf3digo",id:"validaci\xf3n-en-el-c\xf3digo",level:2},{value:"Por Qu\xe9 los Bugs de Consenso Son Cr\xedticos",id:"por-qu\xe9-los-bugs-de-consenso-son-cr\xedticos",level:2},{value:"Lectura Recomendada",id:"lectura-recomendada",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"reglas-de-consenso",children:"Reglas de Consenso"})}),"\n",(0,o.jsx)(n.p,{children:"Las reglas de consenso son la parte m\xe1s cr\xedtica de Bitcoin. Definen qu\xe9 hace v\xe1lido a un bloque y una transacci\xf3n. Cada nodo completo en la red aplica estas reglas de forma independiente \u2014 si un bloque viola cualquier regla, es rechazado sin importar cu\xe1nto proof-of-work lo respalde."}),"\n",(0,o.jsx)(n.h2,{id:"qu\xe9-son-las-reglas-de-consenso",children:"\xbfQu\xe9 Son las Reglas de Consenso?"}),"\n",(0,o.jsx)(n.p,{children:"Las reglas de consenso son el conjunto de condiciones que cada bloque y transacci\xf3n debe satisfacer para ser considerado v\xe1lido. Incluyen:"}),"\n",(0,o.jsx)(n.h3,{id:"reglas-a-nivel-de-bloque",children:"Reglas a Nivel de Bloque"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"El tama\xf1o del bloque no debe exceder el l\xedmite de peso (4M unidades de peso)"}),"\n",(0,o.jsx)(n.li,{children:"El hash del encabezado del bloque debe estar por debajo del objetivo de dificultad actual"}),"\n",(0,o.jsx)(n.li,{children:"La marca de tiempo debe ser mayor que la mediana de los \xfaltimos 11 bloques"}),"\n",(0,o.jsx)(n.li,{children:"La primera transacci\xf3n debe ser una coinbase (y solo la primera)"}),"\n",(0,o.jsx)(n.li,{children:"La recompensa de coinbase no debe exceder el subsidio del bloque + comisiones"}),"\n",(0,o.jsx)(n.li,{children:"La ra\xedz de Merkle debe coincidir con las transacciones en el bloque"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"reglas-a-nivel-de-transacci\xf3n",children:"Reglas a Nivel de Transacci\xf3n"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Las entradas deben referenciar salidas existentes y no gastadas (UTXOs)"}),"\n",(0,o.jsx)(n.li,{children:"Los scripts de entrada deben satisfacer los scripts de salida correspondientes"}),"\n",(0,o.jsx)(n.li,{children:"El valor total de entrada debe ser >= al valor total de salida (la diferencia es la comisi\xf3n)"}),"\n",(0,o.jsx)(n.li,{children:"Sin doble gasto dentro del mismo bloque"}),"\n",(0,o.jsx)(n.li,{children:"La transacci\xf3n no debe ser un duplicado de una transacci\xf3n sin confirmar existente"}),"\n",(0,o.jsx)(n.li,{children:"Las operaciones de firma no deben exceder los l\xedmites"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"validaci\xf3n-de-script",children:"Validaci\xf3n de Script"}),"\n",(0,o.jsx)(n.p,{children:"La validaci\xf3n de script es donde se verifican las condiciones de gasto:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Para cada entrada:\n  1. Recuperar el UTXO que se est\xe1 gastando\n  2. Ejecutar el script de desbloqueo (scriptSig / witness)\n  3. Ejecutar el script de bloqueo (scriptPubKey)\n  4. Si la ejecuci\xf3n tiene \xe9xito \u2192 la entrada es v\xe1lida\n  5. Si la ejecuci\xf3n falla \u2192 toda la transacci\xf3n es inv\xe1lida\n"})}),"\n",(0,o.jsx)(n.h2,{id:"soft-forks",children:"Soft Forks"}),"\n",(0,o.jsx)(n.p,{children:"Los soft forks endurecen las reglas de consenso \u2014 bloques que antes eran v\xe1lidos se vuelven inv\xe1lidos. Los nodos antiguos a\xfan aceptan los nuevos bloques (no violan ninguna regla antigua), as\xed que la red no se divide."}),"\n",(0,o.jsx)(n.h3,{id:"soft-forks-notables",children:"Soft Forks Notables"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Soft Fork"}),(0,o.jsx)(n.th,{children:"A\xf1o"}),(0,o.jsx)(n.th,{children:"BIP(s)"}),(0,o.jsx)(n.th,{children:"Qu\xe9 Cambi\xf3"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"P2SH"}),(0,o.jsx)(n.td,{children:"2012"}),(0,o.jsx)(n.td,{children:"BIP-16"}),(0,o.jsx)(n.td,{children:"Soporte para Pay-to-Script-Hash"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"CLTV"}),(0,o.jsx)(n.td,{children:"2015"}),(0,o.jsx)(n.td,{children:"BIP-65"}),(0,o.jsx)(n.td,{children:"Timelocks absolutos"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"CSV"}),(0,o.jsx)(n.td,{children:"2016"}),(0,o.jsx)(n.td,{children:"BIP-68, 112, 113"}),(0,o.jsx)(n.td,{children:"Timelocks relativos"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"SegWit"}),(0,o.jsx)(n.td,{children:"2017"}),(0,o.jsx)(n.td,{children:"BIP-141, 143, 144"}),(0,o.jsx)(n.td,{children:"Separaci\xf3n de datos witness, correcci\xf3n de maleabilidad"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Taproot"}),(0,o.jsx)(n.td,{children:"2021"}),(0,o.jsx)(n.td,{children:"BIP-340, 341, 342"}),(0,o.jsx)(n.td,{children:"Firmas Schnorr, MAST"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"mecanismos-de-activaci\xf3n",children:"Mecanismos de Activaci\xf3n"}),"\n",(0,o.jsx)(n.p,{children:"C\xf3mo se activan los soft forks en la red:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"BIP-9 (Version Bits)"})," \u2014 Los mineros se\xf1alizan disponibilidad; se activa despu\xe9s de un umbral"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"BIP-8 (Activaci\xf3n Obligatoria)"})," \u2014 Similar a BIP-9 pero con opci\xf3n de activaci\xf3n forzada"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Speedy Trial"})," \u2014 Usado para Taproot; ventana de se\xf1alizaci\xf3n corta, activaci\xf3n retrasada"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"UASF (User Activated Soft Fork)"})," \u2014 Los nodos aplican las reglas independientemente de la se\xf1alizaci\xf3n minera"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"validaci\xf3n-en-el-c\xf3digo",children:"Validaci\xf3n en el C\xf3digo"}),"\n",(0,o.jsx)(n.p,{children:"Las funciones clave de validaci\xf3n en Bitcoin Core:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"CheckBlock()          \u2192 Verificaciones b\xe1sicas de estructura del bloque\nContextualCheckBlock() \u2192 Verificaciones que dependen del estado de la cadena\nConnectBlock()        \u2192 Validaci\xf3n completa + actualizaci\xf3n del conjunto UTXO\nCheckTransaction()    \u2192 Validaci\xf3n individual de transacciones\n"})}),"\n",(0,o.jsxs)(n.p,{children:["El c\xf3digo de validaci\xf3n se encuentra principalmente en ",(0,o.jsx)(n.code,{children:"src/validation.cpp"}),", con verificaciones espec\xedficas de consenso en ",(0,o.jsx)(n.code,{children:"src/consensus/"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"por-qu\xe9-los-bugs-de-consenso-son-cr\xedticos",children:"Por Qu\xe9 los Bugs de Consenso Son Cr\xedticos"}),"\n",(0,o.jsx)(n.p,{children:"Un bug de consenso puede causar:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Divisi\xf3n de cadena"})," \u2014 Los nodos no est\xe1n de acuerdo sobre cu\xe1l cadena es v\xe1lida"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Inflaci\xf3n"})," \u2014 M\xe1s monedas creadas que el l\xedmite de 21M"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Robo"})," \u2014 Fondos gastados sin firmas v\xe1lidas"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Detenci\xf3n de la red"})," \u2014 Los nodos rechazan todos los nuevos bloques"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Por esto los cambios en el c\xf3digo de consenso requieren el proceso de revisi\xf3n m\xe1s riguroso en todo el software de c\xf3digo abierto."}),"\n",(0,o.jsx)(n.h2,{id:"lectura-recomendada",children:"Lectura Recomendada"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://en.bitcoin.it/wiki/Protocol_rules",children:"Reglas de consenso de Bitcoin (Bitcoin Wiki)"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki",children:"BIP-9: Version Bits"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://chaincode.com/",children:"Chaincode Labs: Bitcoin Protocol Development Curriculum"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var i=s(6540);const o={},a=i.createContext(o);function d(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);